{% extends 'base.html' %}
{% block title %}Login{% endblock %}
{% block content %}
    <h2>Login</h2>
    
    <h2 class="text-center mb-4">{% if action == 'register' %}Register{% elif action == 'forgot_password' %}Forgot Password{% else %}Login{% endif %}</h2>
        {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                    <div class="alert alert-{{ category }}" role="alert">{{ message }}</div>
                    {% endfor %}
                {% endif %}
        {% endwith %}

        {% if action == 'register' %}
        <div class="login-container p-4">
                <form method="POST" action="{{ url_for('auth', action='register') }}">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control{% if registration_errors.username %} is-invalid{% endif %}" id="username" name="username">
                        {% if registration_errors.username %}
                        <small class="form-text text-danger">{{ registration_errors.username }}</small>
                        {% endif %}
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control{% if registration_errors.email %} is-invalid{% endif %}" id="email" name="email">
                        {% if registration_errors.email %}
                        <small class="form-text text-danger">{{ registration_errors.email }}</small>
                        {% endif %}
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control{% if registration_errors.password %} is-invalid{% endif %}" id="password" name="password">
                        {% if registration_errors.password %}
                        <small class="form-text text-danger">{{ registration_errors.password }}</small>
                        {% endif %}
                    </div>
                    <div class="mb-3">
                        <label for="confirm_password" class="form-label">Confirm Password</label>
                        <input type="password" class="form-control{% if registration_errors.confirm_password %} is-invalid{% endif %}" id="confirm_password" name="confirm_password">
                        {% if registration_errors.confirm_password %}
                        <small class="form-text text-danger">{{ registration_errors.confirm_password }}</small>
                        {% endif %}
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Register</button>
                </form>
                <p class="mt-3 text-center"><a href="{{ url_for('auth', action='login') }}">Already have an account? Login</a></p>
                <p class="text-center"><a href="{{ url_for('auth', action='forgot_password') }}">Forgot your password?</a></p>
        </div>

        {% elif action == 'forgot_password' %}
        <div class="login-container p-4">
                <form method="POST" action="{{ url_for('auth', action='forgot_password') }}">
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control{% if forgot_password_errors.email %} is-invalid{% endif %}" id="email" name="email">
                        {% if forgot_password_errors.email %}
                        <small class="form-text text-danger">{{ forgot_password_errors.email }}</small>
                        {% endif %}
                    </div>
                    <button type="submit" class="btn btn-info w-100">Request Password Reset</button>
                </form>
                <p class="mt-3 text-center"><a href="{{ url_for('auth', action='login') }}">Back to Login</a></p>
                <p class="text-center"><a href="{{ url_for('auth', action='register') }}">Create an account</a></p>
        </div>

        {% else %} {# Default to login #}
        <div class="login-container p-4">
                <form method="POST" action="{{ url_for('login', action='login') }}">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control{% if login_errors.username %} is-invalid{% endif %}" id="username" name="username">
                        {% if login_errors.username %}
                        <small class="form-text text-danger">{{ login_errors.username }}</small>
                        {% endif %}
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control{% if login_errors.password %} is-invalid{% endif %}" id="password" name="password">
                        {% if login_errors.password %}
                        <small class="form-text text-danger">{{ login_errors.password }}</small>
                        {% endif %}
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Login</button>
                </form>
                <p class="mt-3 text-center">
                    <a href="{{ url_for('auth', action='register') }}">Don't have an account? Register</a> |
                    <a href="{{ url_for('auth', action='forgot_password') }}">Forgot your password?</a>
                </p>
        </div>
    {% endif %}
{%endblock%}