{% extends 'base.html' %}

{% block title %}Create/Edit Timetable{% endblock %}

{% block content %}
    <h2>Create/Edit Timetable</h2>
    <form method="GET" action="{{ url_for('generate') }}">
        <button type="submit">Auto Generate Timetable</button>
    </form>
    <br>
    <form method="POST" id="timetable-form" action="{{ url_for('save_timetable') }}">
        <div id="timetable-entries">
            {% if timetable %}
                {% for slot in timetable %}
                    <div class="timetable-entry">
                        <label for="day_{{ loop.index0 }}">Day:</label>
                        <select name="day_{{ loop.index0 }}" id="day_{{ loop.index0 }}">
                            <option value="">Select Day</option>
                            <option value="Monday" {% if slot.day == 'Monday' %}selected{% endif %}>Monday</option>
                            <option value="Tuesday" {% if slot.day == 'Tuesday' %}selected{% endif %}>Tuesday</option>
                            <option value="Wednesday" {% if slot.day == 'Wednesday' %}selected{% endif %}>Wednesday</option>
                            <option value="Thursday" {% if slot.day == 'Thursday' %}selected{% endif %}>Thursday</option>
                            <option value="Friday" {% if slot.day == 'Friday' %}selected{% endif %}>Friday</option>
                            <option value="Saturday" {% if slot.day == 'Saturday' %}selected{% endif %}>Saturday</option>
                            <option value="Sunday" {% if slot.day == 'Sunday' %}selected{% endif %}>Sunday</option>
                        </select>

                        <label for="time_{{ loop.index0 }}">Time Slot:</label>
                        <select name="time_{{ loop.index0 }}" id="time_{{ loop.index0 }}">
                            <option value="">Select Time Slot</option>
                            <option value="8:50 - 9:30" {% if slot.time == '8:50 - 9:30' %}selected{% endif %}>8:50 - 9:30</option>
                            <option value="9:30 - 10:10" {% if slot.time == '9:30 - 10:10' %}selected{% endif %}>9:30 - 10:10</option>
                            <option value="10:20 - 11:00" {% if slot.time == '10:20 - 11:00' %}selected{% endif %}>10:20 - 11:00</option>
                            <option value="11:00 - 11:40" {% if slot.time == '11:00 - 11:40' %}selected{% endif %}>11:00 - 11:40</option>
                            <option value="11:40 - 12:20" {% if slot.time == '11:40 - 12:20' %}selected{% endif %}>11:40 - 12:20</option>
                            <option value="12:50 - 13:30" {% if slot.time == '12:50 - 13:30' %}selected{% endif %}>12:50 - 13:30</option>
                            <option value="13:30 - 14:10" {% if slot.time == '13:30 - 14:10' %}selected{% endif %}>13:30 - 14:10</option>
                            <option value="14:10 - 14:50" {% if slot.time == '14:10 - 14:50' %}selected{% endif %}>14:10 - 14:50</option>
                            <option value="14:50 - 15:30" {% if slot.time == '14:50 - 15:30' %}selected{% endif %}>14:50 - 15:30</option>
                        </select>

                        <label for="subject_{{ loop.index0 }}">Subject:</label>
                        <select name="subject_{{ loop.index0 }}" id="subject_{{ loop.index0 }}">
                            <option value="">Select Subject</option>
                            <option value="Math" {% if slot.subject == 'Math' %}selected{% endif %}>Math</option>
                            <option value="Chemistry" {% if slot.subject =='Chemistry' %}selected{% endif %}>Chemistry</option>
                            <option value="Physics" {% if slot.subject == 'Physics' %}selected{% endif %}>Physics</option>
                            <option value="Biology" {% if slot.subject == 'Biology' %}selected{% endif %}>Biology</option>
                            <option value="English" {% if slot.subject == 'English' %}selected{% endif %}>English</option>
                            <option value="Computer Science" {% if slot.subject == 'Computer Science' %}selected{% endif %}>Computer Science</option>
                            <option value="Art" {% if slot.subject == 'Art' %}selected{% endif %}>Art</option>
                            <option value="Dance" {% if slot.subject == 'Dance' %}selected{% endif %}>Dance</option>
                            <option value="Music" {% if slot.subject == 'Music' %}selected{% endif %}>Music</option>
                            <option value="Sports" {% if slot.subject == 'Sports' %}selected{% endif %}>Sports</option>
                            <option value="Volleyball" {% if slot.subject == 'Volleyball' %}selected{% endif %}>Volleyball</option>
                            <option value="MSA" {% if slot.subject == 'MSA' %}selected{% endif %}>MSA</option>
                        </select>

                        <label for="teacher_{{ loop.index0 }}">Teacher (Optional):</label>
                        <input type="text" name="teacher_{{ loop.index0 }}" id="teacher_{{ loop.index0 }}" value="{{ slot.teacher }}">

                        <button type="button" class="remove-slot">Delete</button>
                    </div>
                {% endfor %}
            {% else %}
                <div class="timetable-entry">
                    <label for="day_0">Day:</label>
                    <select name="day_0" id="day_0">
                        <option value="">Select Day</option>
                        <option value="Monday">Monday</option>
                        <option value="Tuesday">Tuesday</option>
                        <option value="Wednesday">Wednesday</option>
                        <option value="Thursday">Thursday</option>
                        <option value="Friday">Friday</option>
                        <option value="Saturday">Saturday</option>
                        <option value="Sunday">Sunday</option>
                    </select>

                    <label for="time_0">Time Slot:</label>
                    <select name="time_0" id="time_0">
                        <option value="">Select Time Slot</option>
                        <option value="8:50 - 9:30">8:50 - 9:30</option>
                        <option value="9:30 - 10:10">9:30 - 10:10</option>
                        <option value="10:20 - 11:00">10:20 - 11:00</option>
                        <option value="11:00 - 11:40">11:00 - 11:40</option>
                        <option value="11:40 - 12:20">11:40 - 12:20</option>
                        <option value="12:50 - 13:30">12:50 - 13:30</option>
                        <option value="13:30 - 14:10">13:30 - 14:10</option>
                        <option value="14:10 - 14:50">14:10 - 14:50</option>
                        <option value="14:50 - 15:30">14:50 - 15:30</option>
                    </select>

                    <label for="subject_0">Subject:</label>
                    <select name="subject_0" id="subject_0">
                        <option value="">Select Subject</option>
                        <option value="Math">Math</option>
                        <option value="Chemistry">Chemistry</option>
                        <option value="Physics">Physics</option>
                        <option value="Biology">Biology</option>
                        <option value="English">English</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Art">Art</option>
                        <option value="Dance">Dance</option>
                        <option value="Music">Music</option>
                        <option value="Sports">Sports</option>
                        <option value="Volleyball">Volleyball</option>
                        <option value="MSA">MSA</option>
                    </select>

                    <label for="teacher_0">Teacher (Optional):</label>
                    <input type="text" name="teacher_0" id="teacher_0">

                    <button type="button" class="remove-slot">Delete</button>
                </div>
            {% endif %}
        </div>

        <button type="button" id="add-slot">Add Period</button>
        <button type="submit">Save Timetable</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const addSlotButton = document.getElementById('add-slot');
            const timetableEntries = document.getElementById('timetable-entries');
            let counter = timetableEntries.children.length;
            const timeSlots = [
                "8:50 - 9:30",
                "9:30 - 10:10",
                "10:20 - 11:00",
                "11:00 - 11:40",
                "11:40 - 12:20",
                "12:50 - 13:30",
                "13:30 - 14:10",
                "14:10 - 14:50",
                "14:50 - 15:30"
            ];
            const subjects = [
                "Math",
                "Chemistry",
                "Physics",
                "Biology",
                "English",
                "Computer Science",
                "Art",
                "Dance",
                "Music",
                "Sports",
                "Volleyball",
                "MSA"
            ];

            addSlotButton.addEventListener('click', function() {
                const newEntry = document.createElement('div');
                newEntry.classList.add('timetable-entry');
                newEntry.innerHTML = `
                    <label for="day_${counter}">Day:</label>
                    <select name="day_${counter}" id="day_${counter}">
                        <option value="">Select Day</option>
                        <option value="Monday">Monday</option>
                        <option value="Tuesday">Tuesday</option>
                        <option value="Wednesday">Wednesday</option>
                        <option value="Thursday">Thursday</option>
                        <option value="Friday">Friday</option>
                        <option value="Saturday">Saturday</option>
                        <option value="Sunday">Sunday</option>
                    </select>

                    <label for="time_${counter}">Time Slot:</label>
                    <select name="time_${counter}" id="time_${counter}">
                        <option value="">Select Time Slot</option>
                        ${timeSlots.map(slot => `<option value="${slot}">${slot}</option>`).join('')}
                    </select>

                    <label for="subject_${counter}">Subject:</label>
                    <select name="subject_${counter}" id="subject_${counter}">
                        <option value="">Select Subject</option>
                        ${subjects.map(subject => `<option value="${subject}">${subject}</option>`).join('')}
                    </select>

                    <label for="teacher_${counter}">Teacher (Optional):</label>
                    <input type="text" name="teacher_${counter}" id="teacher_${counter}">

                    <button type="button" class="remove-slot">Delete</button>
                `;
                timetableEntries.appendChild(newEntry);
                counter++;
            });

            timetableEntries.addEventListener('click', function(event) {
                if (event.target.classList.contains('remove-slot')) {
                    event.target.parentNode.remove();
                }
            });

            document.querySelector('#timetable-form').addEventListener('submit', function() {
                const entries = document.querySelectorAll('.timetable-entry');
                entries.forEach((entry, index) => {
                    entry.querySelector('select[name^="day_"]').name = `day_${index}`;
                    entry.querySelector('select[name^="time_"]').name = `time_${index}`;
                    entry.querySelector('select[name^="subject_"]').name = `subject_${index}`;
                    entry.querySelector('input[name^="teacher_"]').name = `teacher_${index}`;
                });
            });
        });
    </script>
{% endblock %}